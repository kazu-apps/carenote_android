rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Default deny
    match /{document=**} {
      allow read, write: if false;
    }

    // CareRecipient documents: only the authenticated owner can access
    match /careRecipients/{recipientId} {
      allow read, write: if request.auth != null && request.auth.uid == recipientId;

      // Sub-collections inherit parent auth rule
      match /medications/{medicationId} {
        allow read, write: if request.auth != null && request.auth.uid == recipientId;

        // Nested sub-collection: medication logs
        match /logs/{logId} {
          allow read, write: if request.auth != null && request.auth.uid == recipientId;
        }
      }

      match /notes/{noteId} {
        allow read, write: if request.auth != null && request.auth.uid == recipientId;

        match /comments/{commentId} {
          allow read, write: if request.auth != null && request.auth.uid == recipientId;
        }
      }

      match /healthRecords/{recordId} {
        allow read, write: if request.auth != null && request.auth.uid == recipientId;
      }

      match /calendarEvents/{eventId} {
        allow read, write: if request.auth != null && request.auth.uid == recipientId;
      }

      match /tasks/{taskId} {
        allow read, write: if request.auth != null && request.auth.uid == recipientId;
      }
    }
  }
}
