# CareNote - å®¶æ—ã§ã¤ãªãŒã‚‹ä»‹è­·è¨˜éŒ² Android ã‚¢ãƒ—ãƒª

æœè–¬ç®¡ç†ã€å¥åº·è¨˜éŒ²ã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã€ã‚¿ã‚¹ã‚¯ã€ãƒ¡ãƒ¢ãƒ»ç”³ã—é€ã‚Šã‚’æ­è¼‰ã—ãŸ
å®¶æ—ä»‹è­·è€…å‘ã‘ Android ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚¢ãƒ—ãƒªã€‚

## ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒãƒ¼ãƒ æ§‹æˆ

ã™ã¹ã¦ã®é–‹ç™ºã‚¿ã‚¹ã‚¯ã¯4äººã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒãƒ¼ãƒ ã§å®Ÿè¡Œã™ã‚‹ã€‚
ãƒªãƒ¼ãƒ€ãƒ¼1äºº + ãƒ¯ãƒ¼ã‚«ãƒ¼3äººã®æ§‹æˆã§ã€ãƒªãƒ¼ãƒ€ãƒ¼ã¯ã‚³ãƒ¼ãƒ‰ã«ç›´æ¥è§¦ã‚Œãªã„ã€‚

### ãƒªãƒ¼ãƒ€ãƒ¼ã®å½¹å‰²
- ã‚¿ã‚¹ã‚¯ã‚’åˆ†æã—ã€ãƒ¯ãƒ¼ã‚«ãƒ¼3äººã®å½¹å‰²ã‚’å‹•çš„ã«æ±ºå®šã™ã‚‹
- ä¸‹è¨˜ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰æœ€é©ãªçµ„ã¿åˆã‚ã›ã‚’é¸ã¶
- ãƒ‡ãƒªã‚²ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆShift+Tabï¼‰ã§é‹ç”¨ã—ã€è‡ªåˆ†ã§ã¯ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªã„
- ãƒ¯ãƒ¼ã‚«ãƒ¼ã®é€²æ—ã‚’ç›£è¦–ã—ã€æˆæœç‰©ã‚’çµ±åˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹
- ãƒ•ã‚¡ã‚¤ãƒ«ç«¶åˆãŒèµ·ããªã„ã‚ˆã†ãƒ¯ãƒ¼ã‚«ãƒ¼ã®æ‹…å½“ç¯„å›²ã‚’æ˜ç¢ºã«æŒ‡ç¤ºã™ã‚‹
- æœ€çµ‚çš„ãªå“è³ªç¢ºèªã¨å®Œäº†åˆ¤å®šã‚’è¡Œã†

### ãƒ¯ãƒ¼ã‚«ãƒ¼ã¸ã®æŒ‡ç¤ºãƒ«ãƒ¼ãƒ«
- å„ãƒ¯ãƒ¼ã‚«ãƒ¼ã«ã¯æ‹…å½“ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ˜ç¤ºçš„ã«æŒ‡å®šã™ã‚‹
- åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°ãƒ¯ãƒ¼ã‚«ãƒ¼ãŒåŒæ™‚ç·¨é›†ã—ãªã„
- å…±æœ‰ãƒªã‚½ãƒ¼ã‚¹ï¼ˆbuild.gradle.ktsã€libs.versions.tomlç­‰ï¼‰ã¯1äººã ã‘ãŒæ‹…å½“ã™ã‚‹
- ãƒ¯ãƒ¼ã‚«ãƒ¼åŒå£«ã¯SendMessageã§ç™ºè¦‹ã‚„ä¾å­˜æƒ…å ±ã‚’å…±æœ‰ã™ã‚‹

### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆé›†ï¼šã‚¿ã‚¹ã‚¯ã«å¿œã˜ãŸ3ãƒ¯ãƒ¼ã‚«ãƒ¼ã®å½¹å‰²

ãƒªãƒ¼ãƒ€ãƒ¼ã¯ä¾é ¼å†…å®¹ã«å¿œã˜ã¦ã€ä»¥ä¸‹ã‹ã‚‰æœ€é©ãªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’é¸æŠã™ã‚‹ã€‚
ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ãªã„çµ„ã¿åˆã‚ã›ãŒæœ€é©ãªå ´åˆã¯ã€è‡ªç”±ã«ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã‚ˆã„ã€‚

| ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ | ãƒ¯ãƒ¼ã‚«ãƒ¼A | ãƒ¯ãƒ¼ã‚«ãƒ¼B | ãƒ¯ãƒ¼ã‚«ãƒ¼C |
|------------|----------|----------|----------|
| ğŸ”¨ æ–°æ©Ÿèƒ½å®Ÿè£… | å®Ÿè£…è€…ï¼ˆãƒ­ã‚¸ãƒƒã‚¯+UIï¼‰ | åŸºç›¤æ‹…å½“ï¼ˆDB/API/å‹å®šç¾©ï¼‰ | å“è³ªæ‹…å½“ï¼ˆãƒ†ã‚¹ãƒˆ+ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰ |
| ğŸ› ãƒã‚°èª¿æŸ» | ä»®èª¬â‘ ï¼ˆæœ€æœ‰åŠ›åŸå› ï¼‰ | ä»®èª¬â‘¡ï¼ˆæ¬¡ç‚¹åŸå› ï¼‰ | ä»®èª¬â‘¢ï¼ˆãã®ä»–ï¼‰ |
| ğŸ“ ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦³ç‚¹ | å“è³ªãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦³ç‚¹ | ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸è¦³ç‚¹ |
| ğŸ”„ ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚° | æ§‹é€ æ”¹å–„ | ãƒ†ã‚¹ãƒˆæ•´å‚™ | ç§»è¡Œä½œæ¥­ |
| ğŸ—ï¸ ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ¥å®Ÿè£… | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ | ãƒ‡ãƒ¼ã‚¿å±¤ |
| ğŸ“¦ ãƒªãƒªãƒ¼ã‚¹æº–å‚™ | ã‚³ãƒ¼ãƒ‰ä»•ä¸Šã’ | ãƒ†ã‚¹ãƒˆå¼·åŒ– | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ |
| ğŸ” æŠ€è¡“èª¿æŸ» | æ—¢å­˜ã‚³ãƒ¼ãƒ‰åˆ†æ | å¤–éƒ¨ãƒªã‚µãƒ¼ãƒ | ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ¤œè¨¼ |

### ãƒªãƒ¼ãƒ€ãƒ¼ã®é€²è¡Œãƒ•ãƒ­ãƒ¼
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¾é ¼ã‚’åˆ†æã—ã€ä¸Šè¨˜ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰æœ€é©ãªã‚‚ã®ã‚’é¸ã¶
2. 3ãƒ¯ãƒ¼ã‚«ãƒ¼ã®å½¹å‰²ã€æ‹…å½“ãƒ•ã‚¡ã‚¤ãƒ«ã€ã‚¿ã‚¹ã‚¯ä¾å­˜é–¢ä¿‚ã‚’æ±ºå®šã™ã‚‹
3. TeamCreateã§3ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚’ç”Ÿæˆã—ã€ååˆ†ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¸¡ã™
4. é€²æ—ã‚’Ctrl+Tã§ç¢ºèªã€å¿…è¦ã«å¿œã˜ã¦SendMessageã§è»Œé“ä¿®æ­£
5. å…¨ãƒ¯ãƒ¼ã‚«ãƒ¼å®Œäº†å¾Œã€æˆæœç‰©ã‚’çµ±åˆãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã€å•é¡ŒãŒã‚ã‚Œã°ä¿®æ­£æŒ‡ç¤º
6. æœ€çµ‚ç¢ºèªã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«çµæœã‚’å ±å‘Šã™ã‚‹

---

## ã‚¯ã‚¤ãƒƒã‚¯ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

```bash
# ãƒ“ãƒ«ãƒ‰
./gradlew.bat assembleDebug

# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
./gradlew.bat testDebugUnitTest

# ç‰¹å®šãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹å®Ÿè¡Œ
./gradlew.bat testDebugUnitTest --tests "com.carenote.app.domain.common.ResultTest"

# UI ãƒ†ã‚¹ãƒˆï¼ˆè¦ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ï¼‰
./gradlew.bat connectedDebugAndroidTest

# ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼ˆ80% LINE é–¾å€¤ï¼‰
./gradlew.bat jacocoTestReport jacocoTestCoverageVerification

# é™çš„è§£æï¼ˆCLI ãƒ„ãƒ¼ãƒ«ã€‚Gradle ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã¯ãªã„ï¼‰
detekt --config detekt.yml --input app/src/main/java
```

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ |
|---------|------|
| è¨€èª | Kotlin 2.0.21 / JVM 17 |
| UI | Jetpack Compose + Material 3 (BOM 2024.12.01) |
| DI | Hilt 2.53.1 (KSP) |
| DB | Room 2.8.4 + SQLCipher 4.6.1 (`carenote_database` v12 baseline) |
| ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ | Navigation Compose 2.8.5 |
| éåŒæœŸ | Coroutines 1.9.0 + StateFlow |
| ãƒ­ã‚° | Timber 5.0.1 |
| Firebase | BOM 33.7.0 (Auth, Firestore, Messaging, Crashlytics) |
| WorkManager | 2.10.0 (HiltWorker) |
| ãƒ†ã‚¹ãƒˆ | JUnit 4 + MockK 1.13.9 + Turbine 1.0.0 + Robolectric 4.14.1 |
| SDK | compileSdk 35, minSdk 26, targetSdk 35 |

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### Clean Architectureï¼ˆä¾å­˜æ–¹å‘: ui â†’ domain â†’ dataï¼‰

- **ui**: Jetpack Compose Screen + ViewModel (Hilt @Inject)ã€‚State ã¯ `StateFlow` ã§ç®¡ç†
- **domain**: Repository interfaces, domain models, `Result<T, DomainError>`
- **data**: Room DB, Firestore, Repository implementations, Mapper

### DI ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

| ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | è²¬å‹™ |
|-----------|------|
| `di/AppModule.kt` | Repository ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° + Gson |
| `di/DatabaseModule.kt` | Room DB + DAO (8 ãƒ†ãƒ¼ãƒ–ãƒ«) |
| `di/FirebaseModule.kt` | FirebaseAuth, Firestore, Messaging + AuthRepository |
| `di/SyncModule.kt` | SyncRepository + EntitySyncer ç¾¤ |
| `di/WorkerModule.kt` | WorkManager + SyncWorkScheduler |

### ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³

`ui/navigation/Screen.kt` ã® sealed class ã§ãƒ«ãƒ¼ãƒˆå®šç¾©:
- **Auth**: Login, Register, ForgotPassword
- **BottomNav**: Medication, Calendar, Tasks, HealthRecords, Notes
- **Secondary**: Settings, AddMedication
- `ui/navigation/CareNoteNavHost.kt` ã§ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç†

### ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

- `domain/common/Result.kt` â€” ç‹¬è‡ªã® `Result<T, E>` sealed classï¼ˆkotlin.Result ã§ã¯ãªã„ï¼‰
- `domain/common/DomainError.kt` â€” 6 ç¨®ã® sealed class (Database, NotFound, Validation, Network, Unauthorized, Unknown)
- DomainError ã¯ **Throwable ã§ã¯ãªã„**ã€‚Timber ã«æ¸¡ã™éš›ã¯ `Timber.w("msg: $error")` ã¨æ–‡å­—åˆ—åŒ–

### åŒæœŸãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆFirestoreï¼‰

- `domain/common/SyncResult.kt` â€” åŒæœŸçµæœ (Success, PartialSuccess, Failure)
- `domain/common/SyncState.kt` â€” åŒæœŸçŠ¶æ…‹ (Idle, Syncing, Success, Error)
- **ç«¶åˆè§£æ±º**: Last-Write-Wins (LWW) â€” `updatedAt` æ¯”è¼ƒã§æ–°ã—ã„æ–¹ã‚’æ¡ç”¨

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹æˆ

```
app/src/main/java/com/carenote/app/
â”œâ”€â”€ config/          AppConfigï¼ˆå…¨è¨­å®šå€¤ã®ä¸€å…ƒç®¡ç†ã€‚ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ç¦æ­¢ï¼‰
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ local/       Room (DB, DAO, Entity, Converter, Migration)
â”‚   â”œâ”€â”€ mapper/      Entity â†” Domain ãƒãƒƒãƒ‘ãƒ¼
â”‚   â”‚   â””â”€â”€ remote/  Firestore â†” Domain ãƒãƒƒãƒ‘ãƒ¼ (RemoteMapper)
â”‚   â”œâ”€â”€ remote/
â”‚   â”‚   â””â”€â”€ model/   SyncMetadataï¼ˆåŒæœŸãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰
â”‚   â”œâ”€â”€ repository/  Repository å®Ÿè£…
â”‚   â”‚   â””â”€â”€ sync/    EntitySyncer + å„ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ Syncer
â”‚   â”œâ”€â”€ service/     CareNoteMessagingService (FCM)
â”‚   â””â”€â”€ worker/      SyncWorker, MedicationReminderWorker
â”œâ”€â”€ di/              Hilt ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« (App, Database, Firebase, Sync, Worker)
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ common/      Result<T,E>, DomainError, SyncResult, SyncState
â”‚   â”œâ”€â”€ model/       ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ« (data class, immutable)
â”‚   â””â”€â”€ repository/  Repository ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â””â”€â”€ ui/
    â”œâ”€â”€ navigation/  Screen sealed class + CareNoteNavHost
    â”œâ”€â”€ screens/     å„ç”»é¢ (Screen.kt)
    â”‚   â””â”€â”€ auth/    LoginScreen, RegisterScreen, ForgotPasswordScreen
    â”œâ”€â”€ theme/       Material3 ãƒ†ãƒ¼ãƒï¼ˆColor, Type, Themeï¼‰
    â””â”€â”€ util/        NotificationHelper, CrashlyticsTree
```

## Firebase çµ±åˆ

### Firebase Authï¼ˆèªè¨¼ï¼‰

- `AuthRepository` â€” èªè¨¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (signIn, signUp, signOut, etc.)
- `FirebaseAuthRepositoryImpl` â€” Firebase Auth å®Ÿè£…
- `currentUser: Flow<User?>` ã§èªè¨¼çŠ¶æ…‹ã‚’ç›£è¦–
- FirebaseAuthException â†’ DomainError ãƒãƒƒãƒ”ãƒ³ã‚°

### Cloud Firestoreï¼ˆãƒ‡ãƒ¼ã‚¿åŒæœŸï¼‰

- **æ§‹é€ **: `careRecipients/{id}/medications/{id}` ã®ã‚µãƒ–ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ§‹é€ 
- **åŒæœŸ**: Room â†” Firestore åŒæ–¹å‘åŒæœŸ
- **ID ãƒãƒƒãƒ”ãƒ³ã‚°**: `sync_mappings` ãƒ†ãƒ¼ãƒ–ãƒ«ã§ Room ID â†” Firestore ID ã‚’ç®¡ç†

### EntitySyncer ãƒ‘ã‚¿ãƒ¼ãƒ³

```kotlin
// åŸºåº•ã‚¯ãƒ©ã‚¹: data/repository/sync/EntitySyncer.kt
abstract class EntitySyncer<Entity, Domain> {
    abstract val entityType: String
    abstract fun collectionPath(careRecipientId: String): String

    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ¡ã‚½ãƒƒãƒ‰
    suspend fun sync(careRecipientId: String, lastSyncTime: LocalDateTime?): SyncResult {
        val pushResult = pushLocalChanges(...)
        val pullResult = pullRemoteChanges(...)
        return mergeResults(pushResult, pullResult)
    }
}
```

å„ Syncer: `MedicationSyncer`, `MedicationLogSyncer`, `NoteSyncer`, `HealthRecordSyncer`, `CalendarEventSyncer`, `TaskSyncer`

### RemoteMapper ãƒ‘ã‚¿ãƒ¼ãƒ³

```kotlin
// ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹: data/mapper/remote/RemoteMapper.kt
interface RemoteMapper<Domain> {
    fun toDomain(data: Map<String, Any?>): Domain
    fun toRemote(domain: Domain, syncMetadata: SyncMetadata?): Map<String, Any?>
    fun extractSyncMetadata(data: Map<String, Any?>): SyncMetadata
}
```

### FCMï¼ˆãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ï¼‰

- `CareNoteMessagingService` â€” FirebaseMessagingService å®Ÿè£…
- `NotificationHelper` â€” é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ç®¡ç† + é€šçŸ¥è¡¨ç¤º

### Crashlytics

- `CrashlyticsTree` â€” Timber Tree å®Ÿè£…
- WARN ä»¥ä¸Šã®ãƒ­ã‚°ã‚’ Crashlytics ã«é€ä¿¡
- ä¾‹å¤–ã¯ `recordException()` ã§è‡ªå‹•è¨˜éŒ²

## Worker ãƒ‘ã‚¿ãƒ¼ãƒ³

### SyncWorkerï¼ˆå®šæœŸåŒæœŸï¼‰

```kotlin
@HiltWorker
class SyncWorker : CoroutineWorker {
    // 1. èªè¨¼ç¢ºèª
    // 2. careRecipientId å–å¾—
    // 3. syncRepository.syncAll() å®Ÿè¡Œ
    // 4. çµæœã«å¿œã˜ã¦ Result.success/retry/failure
}
```

- å®šæœŸå®Ÿè¡Œ: 15åˆ†é–“éš”ï¼ˆWorkManager æœ€å°å€¤ï¼‰
- åˆ¶ç´„: NetworkType.CONNECTED
- ãƒªãƒˆãƒ©ã‚¤: NetworkError â†’ å¯èƒ½, UnauthorizedError â†’ ä¸å¯

### MedicationReminderWorkerï¼ˆæœè–¬ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ï¼‰

- æŒ‡å®šæ™‚åˆ»ã«é€šçŸ¥ã‚’ç™ºè¡Œ
- ãŠã‚„ã™ã¿æ™‚é–“ï¼ˆquietHoursï¼‰ãƒã‚§ãƒƒã‚¯
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã§é€šçŸ¥ã‚ªãƒ³/ã‚ªãƒ•

## ãƒ†ãƒ¼ãƒ

- **ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ**ï¼ˆæ¸©ã‹ã¿ã®ã‚ã‚‹ã‚¯ãƒªãƒ¼ãƒ èƒŒæ™¯ #FFF8F0ï¼‰
- **ãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼**: ã‚°ãƒªãƒ¼ãƒ³ç³»ï¼ˆä¿¡é ¼æ„Ÿ #2E7D32ï¼‰
- **ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º**: bodyLarge 18spï¼ˆé«˜é½¢è€…å‘ã‘å¤§ãã‚ï¼‰
- **æœ€å°ã‚¿ãƒƒãƒã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**: 48dp

## ãƒ†ã‚¹ãƒˆ

### æ§‹æˆ

| ç¨®é¡ | ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | å ´æ‰€ |
|------|-------------|------|
| Unit | JUnit 4 + MockK + Turbine + Coroutines Test | `app/src/test/` |
| UI/E2E | Hilt + Espresso + UIAutomator + Compose UI Test | `app/src/androidTest/` |
| Runner | `com.carenote.app.HiltTestRunner` | build.gradle.kts |
| ã‚«ãƒãƒ¬ãƒƒã‚¸ | JaCoCo 0.8.12ï¼ˆLINE 80% é–¾å€¤ï¼‰ | `jacocoTestCoverageVerification` |

### Fake Repository ãƒ‘ã‚¿ãƒ¼ãƒ³

`test/.../fakes/` ã«é…ç½®ã€‚`MutableStateFlow<List<T>>` ã§ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªçŠ¶æ…‹ç®¡ç†ã€‚

Firebase é–¢é€£:
- `FakeAuthRepository` â€” èªè¨¼çŠ¶æ…‹ã®ãƒ†ã‚¹ãƒˆåˆ¶å¾¡
- `FakeSyncRepository` â€” åŒæœŸçŠ¶æ…‹ã®ãƒ†ã‚¹ãƒˆåˆ¶å¾¡
- `FakeSyncWorkScheduler` â€” WorkManager ä¾å­˜æ’é™¤

### E2E ãƒ†ã‚¹ãƒˆ

`androidTest/.../di/TestFirebaseModule.kt` ã§æœ¬ç•ªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ Fake ã«ç½®æ›ã€‚

## ã‚³ãƒ¼ãƒ‰è¦ç´„

### ãƒ­ã‚°

**Timber å¿…é ˆ**ã€‚`println()`, `Log.d()`, `Log.e()` ç­‰ã¯ç¦æ­¢ã€‚

**PII ãƒ­ã‚°ç¦æ­¢**: UID, email, å€‹äººåç­‰ã‚’ãƒ­ã‚°ã«å«ã‚ãªã„ã€‚
```kotlin
// NG
Timber.d("User signed in: ${user.uid}")

// OK
Timber.d("User signed in successfully")
```

### i18nï¼ˆå¤šè¨€èªå¯¾å¿œï¼‰

- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: æ—¥æœ¬èª `res/values/strings.xml`
- è‹±èª: `res/values-en/strings.xml`
- **æ–°è¦æ–‡å­—åˆ—è¿½åŠ æ™‚ã¯å¿…ãšä¸¡æ–¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°**

### è¨­å®šå€¤

ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã¯å…¨ã¦ `config/AppConfig.kt` ã«é›†ç´„ã€‚ç›´æ¥ãƒªãƒ†ãƒ©ãƒ«ã‚’ä½¿ã‚ãªã„ã€‚

ä¸»è¦ã‚«ãƒ†ã‚´ãƒª:
- `AppConfig.Auth` â€” èªè¨¼é–¢é€£ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰é•·ã€ãƒ¡ãƒ¼ãƒ«é•·ï¼‰
- `AppConfig.Sync` â€” åŒæœŸé–¢é€£ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã€ãƒªãƒˆãƒ©ã‚¤å›æ•°ï¼‰
- `AppConfig.Notification` â€” é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ« ID

### Detekt ãƒ«ãƒ¼ãƒ«ï¼ˆmaxIssues=0ï¼‰

| ãƒ«ãƒ¼ãƒ« | é–¾å€¤ |
|--------|------|
| LongMethod | 50 è¡Œ |
| LargeClass | 800 è¡Œ |
| MaxLineLength | 120 æ–‡å­— |
| NestedBlockDepth | 4 |
| CyclomaticComplexMethod | 15 |

## ã‚ˆãã‚ã‚‹è½ã¨ã—ç©´

1. **Detekt ã¯ CLI ãƒ„ãƒ¼ãƒ«** â€” Gradle ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦è¿½åŠ ã—ãªã„ã“ã¨ï¼ˆMockK ã‚¤ãƒ³ã‚¹ãƒˆãƒ«ãƒ¡ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¨ç«¶åˆï¼‰
2. **Room Entity å¤‰æ›´æ™‚** â€” Migration ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ + `DatabaseModule.kt` ã¸ã®ç™»éŒ²ãŒå¿…é ˆï¼ˆv12 ã‚’ baseline ã¨ã—ã¦ squash æ¸ˆã¿ã€‚v1-v11 ã® migration ã¯å‰Šé™¤æ¸ˆã¿ã€‚æ–°è¦ migration ã¯ v12 ä»¥é™ã‹ã‚‰ä½œæˆã™ã‚‹ã€‚æœªãƒªãƒªãƒ¼ã‚¹ã®ãŸã‚ `fallbackToDestructiveMigration()` ã‚’ä½¿ç”¨ä¸­ï¼‰
3. **strings.xml ã¯ JP/EN ãƒšã‚¢æ›´æ–°** â€” ç‰‡æ–¹ã ã‘æ›´æ–°ã™ã‚‹ã¨å®Ÿè¡Œæ™‚ã«è‹±èª/æ—¥æœ¬èªãŒæ··åœ¨
4. **DomainError ã¯ Throwable ã§ã¯ãªã„** â€” `Timber.w(error, msg)` ã¯ä½¿ãˆãªã„ã€‚`Timber.w("msg: $error")` ã¨æ›¸ã
5. **Result ã¯ç‹¬è‡ªå®Ÿè£…** â€” `domain/common/Result.kt` ã® `Result<T, E>`ã€‚kotlin.Result ã§ã¯ãªã„
6. **Windows ç’°å¢ƒ** â€” `./gradlew.bat` ã‚’ä½¿ç”¨ã€‚ãƒ‘ã‚¹åŒºåˆ‡ã‚Šã¯ `\`
7. **ProGuard (release)** â€” æ–°ãƒ©ã‚¤ãƒ–ãƒ©ãƒªè¿½åŠ æ™‚ã¯ `app/proguard-rules.pro` ã® keep ãƒ«ãƒ¼ãƒ«ç¢ºèª
8. **Zero Detekt tolerance** â€” maxIssues=0, all issues must be fixed
9. **google-services.json** â€” Firebase è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã€‚`.gitignore` æ¸ˆã¿ã€‚`docs/FIREBASE_SETUP.md` å‚ç…§
10. **PII ãƒ­ã‚°ç¦æ­¢** â€” UID, email, å€‹äººåã‚’ãƒ­ã‚°ã«å«ã‚ãªã„ï¼ˆL-2 ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¦ä»¶ï¼‰
11. **WorkManager æœ€å°é–“éš”** â€” å®šæœŸå®Ÿè¡Œã¯æœ€çŸ­ 15åˆ†ã€‚ãã‚Œæœªæº€ã¯è¨­å®šã—ã¦ã‚‚ 15åˆ†ã«ãªã‚‹
12. **Firebase ä¾‹å¤–å‡¦ç†** â€” FirebaseAuthException ã¯ DomainError ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã—ã¦è¿”ã™

## ä»Šå¾Œã®è¿½åŠ äºˆå®š

- Firebase Cloud Storageï¼ˆå†™çœŸä¿å­˜ï¼‰
- Google Play Billingï¼ˆãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
